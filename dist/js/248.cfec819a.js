"use strict";(self["webpackChunktohsaka_blog"]=self["webpackChunktohsaka_blog"]||[]).push([[248],{6248:function(t,i,e){e.r(i),e.d(i,{default:function(){return g}});var s=function(){var t=this,i=t._self._c;return i("div",{ref:"waterfall",attrs:{id:"waterfall"}},t._l(t.imgsArr_c,(function(e,s){return i("div",{key:s,ref:"imgBox",refInFor:!0,staticClass:"img-box default-card-animation",style:{width:t.imgWidth+"px",height:e._height+"px"}},[i("img",{attrs:{"data-src":e.src}})])})),0)},r=[],h=(e(7658),e(3822)),l={name:"waterfall",data(){return{imgsArr:[],imgsArr_c:[],imgCol:5,imgGap:5,loadedCount:0,newCounts:20,theFirst:0,cNumber:0,imgBoxEls:[],beginIndex:0,colsHeightArr:[],reachBottomDistance:-500,viewHeight:0}},computed:{...(0,h.rn)("image",["imgaesUrlList"]),waterfallWidth(){return this.$refs["waterfall"].clientWidth-9},imgWidth(){return this.colWidth-2*this.imgGap},colWidth(){return this.waterfallWidth/this.colNum},colNum(){return this.isMobile?2:this.imgCol}},watch:{imgsArr(t,i){(this.imgsArr_c.length>t.length||this.imgsArr_c.left>0&&t[0]&&!t[0]._height)&&this.reset(),this.preLoad()}},methods:{preLoad(){this.imgsArr.forEach(((t,i)=>{if(!(i<this.loadedCount))if(t.src){let e=new Image;e.src=t.src,e.onload=e.onerror=t=>{this.imgsArr[i]._height="load"===t.type?Math.round(this.imgWidth*(e.height/e.width)):this.imgWidth,"error"===t.type&&(this.imgsArr[i]._error=!0),++this.loadedCount,this.imgsArr.length===this.loadedCount&&this.preloaded(this.cNumber)}}else this.imgsArr[i]._height="0",++this.loadedCount,this.imgsArr.length===this.loadedCount&&this.preloaded(),console.log(111111)}))},preloaded(t){if(0==this.theFirst){for(let t=0;t<20;t++)this.imgsArr_c.push(this.imgsArr[t]);this.$nextTick((()=>{this.waterfall()}))}else{this.cNumber+=20;for(let i=t;i<this.cNumber;i++)this.imgsArr_c.push(this.imgsArr[i]);this.$nextTick((()=>{this.waterfall()}))}},waterfall(){if(this.imgBoxEls=this.$refs["imgBox"],!this.imgBoxEls)return;let t,i,e;0===this.beginIndex&&(this.colsHeightArr=[]);for(let s=this.beginIndex;s<this.imgBoxEls.length;++s){if(!this.imgBoxEls[s])return;if(e=this.imgBoxEls[s].offsetHeight,s<this.colNum)this.colsHeightArr.push(e),t=0,i=s*this.colWidth;else{let s=Math.min.apply(null,this.colsHeightArr),r=this.colsHeightArr.indexOf(s);t=s,i=r*this.colWidth,this.colsHeightArr[r]+=e}if(this.imgBoxEls[s].style.top=t+"px",this.imgBoxEls[s].style.left=i+"px",t<this.viewHeight){let t=this.imgBoxEls[s].children[0];t.src=t.getAttribute("data-src"),t.style.opacity=1,t.style.transform="scale(1)"}}this.beginIndex=this.imgBoxEls.length},reset(){this.imgsArr_c=[],this.beginIndex=[],this.loadedCount=0},scrollFn(){let t=Math.min.apply(null,this.colsHeightArr),i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;i+this.viewHeight>t-this.reachBottomDistance&&this.handleReachBottom(),this.imgBoxEls.forEach(((t,e)=>{let s=t.children[0];if(s.src)return;let r=t.style.top;r=Number.parseFloat(r.slice(0,r.length-2)),i+this.viewHeight>=r&&(s.src=s.getAttribute("data-src"),s.style.opacity=1,s.style.transform="scale(1)")}))},scroll(){window.onscroll=this.throttle(this.scrollFn,500)},handleReachBottom(){setTimeout((()=>{this.loadImages(this.newCounts)}),500),console.log("--this.imgsArr--",this.imgsArr)},throttle(t,i){let e=!0;return function(){e&&(e=!1,setTimeout((()=>{t.apply(this),e=!0}),i))}},loadImages(t){this.$store.dispatch("image/getImagesList"),this.newCounts+=20;for(let i=t;i<this.newCounts;i++){let t={src:"",href:"",info:""};t.src=this.imgaesUrlList[i],t.href=i,t.info=i,this.imgsArr.push(t)}console.log(this.imgsArr)}},created(){this.$store.dispatch("image/getImagesList"),setTimeout((()=>{for(let t=0;t<20;t++){let i={src:"",href:"",info:""};i.src=this.imgaesUrlList[t],i.href=t,i.info=t,this.imgsArr.push(i)}this.theFirst=1}),300)},mounted(){this.viewHeight=0==document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,this.preLoad(),this.scroll()}},o=l,n=e(1001),a=(0,n.Z)(o,s,r,!1,null,"7699f9b8",null),g=a.exports}}]);
//# sourceMappingURL=248.cfec819a.js.map